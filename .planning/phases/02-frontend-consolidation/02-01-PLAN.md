---
phase: 02-frontend-consolidation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scrapegrape/frontend/ (moved from sgui/)
  - scrapegrape/frontend/vite.config.ts
  - scrapegrape/scrapegrape/settings.py
  - docker-compose.yml
  - scrapegrape/frontend/src/Components/.gitkeep
  - scrapegrape/frontend/src/Layouts/.gitkeep
autonomous: false

must_haves:
  truths:
    - "Production build completes and outputs manifest.json to scrapegrape/frontend/dist/"
    - "Development server starts and HMR updates components without full reload"
    - "Django admin accessible at /admin/ with correct styling"
    - "Static files served correctly in both development and production modes"
  artifacts:
    - path: "scrapegrape/frontend/vite.config.ts"
      provides: "Vite build configuration for consolidated location"
      contains: 'manifest: "manifest.json"'
    - path: "scrapegrape/frontend/src/main.tsx"
      provides: "Entry point with Inertia page resolution"
      contains: "import.meta.glob"
    - path: "scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx"
      provides: "Smoke test page component"
    - path: "scrapegrape/frontend/src/Components/.gitkeep"
      provides: "Shared components directory placeholder"
    - path: "scrapegrape/frontend/src/Layouts/.gitkeep"
      provides: "Page layouts directory placeholder"
    - path: "scrapegrape/scrapegrape/settings.py"
      provides: "Django settings with updated manifest_path and STATICFILES_DIRS"
      contains: 'frontend'
    - path: "docker-compose.yml"
      provides: "Docker Compose with updated vite volume mount"
      contains: "scrapegrape/frontend"
  key_links:
    - from: "scrapegrape/scrapegrape/settings.py"
      to: "scrapegrape/frontend/dist/manifest.json"
      via: "DJANGO_VITE manifest_path setting"
      pattern: 'frontend.*dist.*manifest'
    - from: "scrapegrape/frontend/vite.config.ts"
      to: "scrapegrape/frontend/dist/"
      via: "build.outDir configuration"
      pattern: 'outDir.*dist'
    - from: "docker-compose.yml"
      to: "scrapegrape/frontend/"
      via: "vite service volume mount"
      pattern: 'scrapegrape/frontend'
    - from: "scrapegrape/scrapegrape/settings.py"
      to: "scrapegrape/frontend/dist/"
      via: "STATICFILES_DIRS for collectstatic"
      pattern: 'STATICFILES_DIRS'
---

<objective>
Move React frontend from sgui/ to scrapegrape/frontend/, update all path references in Vite config, Django settings, and Docker Compose, establish Inertia directory structure, and verify the build pipeline works in both dev and production modes.

Purpose: Consolidate the project into a single directory structure (scrapegrape/) so Django backend and React frontend are co-located. This simplifies development, deployment, and the remaining Inertia migration phases.

Output: Working build pipeline from scrapegrape/frontend/ with dev HMR, production builds, and correct static file serving.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-inertia-infrastructure/01-01-SUMMARY.md
@.planning/phases/02-frontend-consolidation/02-RESEARCH.md
@scrapegrape/scrapegrape/settings.py
@sgui/vite.config.ts
@docker-compose.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Move sgui/ to scrapegrape/frontend/ and establish Inertia directory structure</name>
  <files>
    scrapegrape/frontend/ (entire directory, moved from sgui/)
    scrapegrape/frontend/src/Components/.gitkeep
    scrapegrape/frontend/src/Layouts/.gitkeep
  </files>
  <action>
    1. Move the sgui/ directory to scrapegrape/frontend/:
       ```
       mv sgui scrapegrape/frontend
       ```
       This moves ALL contents including node_modules, package.json, vite.config.ts, tsconfig.json, src/, dist/, etc.

    2. Create the Inertia directory structure for Phase 3+ use:
       - Create `scrapegrape/frontend/src/Components/` with a `.gitkeep` file
       - Create `scrapegrape/frontend/src/Layouts/` with a `.gitkeep` file
       Note: Pages/ already exists (created in Phase 1 with Debug/InertiaTest.tsx).
       Note: Keep existing lowercase directories as-is (components/, datatable/, lib/) -- they contain working shadcn/TanStack code.

    3. Verify the move was clean:
       - Confirm sgui/ no longer exists
       - Confirm scrapegrape/frontend/src/main.tsx exists
       - Confirm scrapegrape/frontend/vite.config.ts exists
       - Confirm scrapegrape/frontend/package.json exists
       - Confirm scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx exists

    No changes needed to vite.config.ts -- it already has the correct configuration:
    - `manifest: "manifest.json"` (already set, generates dist/manifest.json)
    - `outDir: "dist"` (relative to config file, correct after move)
    - `base: "/static/"` (matches Django STATIC_URL)
    - `resolve.alias @` uses `__dirname` (relative to config, correct after move)

    No changes needed to main.tsx -- import.meta.glob uses relative path `./Pages/**/*.tsx` which is relative to main.tsx location (unchanged relative to Pages/).

    No changes needed to tsconfig.json or tsconfig.app.json -- paths use `./src/*` relative to config file location (correct after move).
  </action>
  <verify>
    Run these checks:
    - `test ! -d sgui` (sgui/ must not exist)
    - `test -f scrapegrape/frontend/src/main.tsx` (main entry point exists)
    - `test -f scrapegrape/frontend/vite.config.ts` (vite config exists)
    - `test -f scrapegrape/frontend/package.json` (package.json exists)
    - `test -f scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx` (smoke test page exists)
    - `test -d scrapegrape/frontend/src/Components` (Inertia shared components dir exists)
    - `test -d scrapegrape/frontend/src/Layouts` (Inertia layouts dir exists)
    - `test -d scrapegrape/frontend/src/components/ui` (existing shadcn components preserved)
    - `test -d scrapegrape/frontend/src/datatable` (existing datatable preserved)
  </verify>
  <done>
    sgui/ directory no longer exists. scrapegrape/frontend/ contains all frontend source files, config files, and node_modules. Pages/, Components/, and Layouts/ directories exist under src/. Existing lowercase component directories (components/, datatable/, lib/) preserved.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update Django settings, Docker Compose, and STATICFILES_DIRS for new frontend location</name>
  <files>
    scrapegrape/scrapegrape/settings.py
    docker-compose.yml
  </files>
  <action>
    1. Update scrapegrape/scrapegrape/settings.py:

       a. Change DJANGO_VITE manifest_path from:
          `BASE_DIR.parent / "sgui" / "dist" / "manifest.json"`
          to:
          `BASE_DIR / "frontend" / "dist" / "manifest.json"`

          Note: BASE_DIR is `scrapegrape/` (the Django project root, parent of settings.py's parent).
          The frontend is now at `scrapegrape/frontend/`, so the path is `BASE_DIR / "frontend" / ...`.
          The old path used `BASE_DIR.parent / "sgui"` because sgui/ was at the repo root.

       b. Add STATICFILES_DIRS setting (does not currently exist) to include Vite build output:
          ```python
          STATICFILES_DIRS = [
              BASE_DIR / "frontend" / "dist",
          ]
          ```
          Place this near the existing STATIC_URL setting.
          This is required for `collectstatic` to find Vite-built assets in production.

       c. Update STATIC_URL to include the leading slash (currently `"static/"`, should be `"/static/"`):
          This ensures consistency with Vite's `base: "/static/"` setting.

    2. Update docker-compose.yml:

       Change the vite service volume mount from:
       `./sgui:/app`
       to:
       `./scrapegrape/frontend:/app`

       This ensures the Vite dev server in Docker sees the correct source files.

    3. Run `cd scrapegrape/frontend && npm run build` to verify the production build works from the new location. The build should:
       - Complete without errors
       - Generate scrapegrape/frontend/dist/manifest.json
       - Generate hashed asset files in scrapegrape/frontend/dist/assets/
  </action>
  <verify>
    - `grep -q '"frontend"' scrapegrape/scrapegrape/settings.py` (settings references frontend, not sgui)
    - `grep -q 'STATICFILES_DIRS' scrapegrape/scrapegrape/settings.py` (STATICFILES_DIRS exists)
    - `grep -qv 'sgui' scrapegrape/scrapegrape/settings.py` (no remaining sgui references)
    - `grep -q 'scrapegrape/frontend' docker-compose.yml` (docker volume updated)
    - `grep -qv './sgui' docker-compose.yml` (no remaining sgui references)
    - `cd scrapegrape/frontend && npm run build` exits with code 0
    - `test -f scrapegrape/frontend/dist/manifest.json` (manifest generated)
  </verify>
  <done>
    Django settings point to scrapegrape/frontend/dist/manifest.json for django-vite. STATICFILES_DIRS includes frontend/dist/ for collectstatic. Docker Compose mounts scrapegrape/frontend/ for the vite service. Production build completes successfully and generates manifest.json.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Verify dev server HMR and Django integration work from new location</name>
  <files>
    scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx
  </files>
  <action>
    Human verification checkpoint. Frontend consolidated from sgui/ to scrapegrape/frontend/ with all path references updated. Vite config, Django settings, and Docker Compose all point to the new location. Production build verified programmatically. Now verify dev mode HMR and Django integration manually.
  </action>
  <verify>
    1. Start the Vite dev server: `cd scrapegrape/frontend && npm run dev` -- Server starts on http://localhost:5173 without errors.
    2. Start Django dev server (in another terminal): `cd scrapegrape && uv run python manage.py runserver` -- Server starts on http://localhost:8000 without errors.
    3. Visit http://localhost:8000/_debug/inertia/ -- Inertia smoke test page renders with "Inertia.js is working!" heading and debug info.
    4. Visit http://localhost:8000/ -- Legacy publisher table view renders correctly (same as before).
    5. Visit http://localhost:8000/admin/ -- Django admin login page renders with correct CSS styling (not unstyled HTML).
    6. Test HMR: Edit scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx (change the heading text) -- Browser updates automatically without full page reload.
  </verify>
  <done>
    All 6 verification checks pass: Vite dev server starts, Django dev server starts, Inertia smoke test renders, legacy table view works, Django admin has correct styling, and HMR updates components without full page reload.
  </done>
</task>

</tasks>

<verification>
Phase 2 verification checklist:
1. CONS-01: React source lives in scrapegrape/frontend/src/ (sgui/ does not exist)
2. CONS-02: Vite config at scrapegrape/frontend/vite.config.ts has correct paths (manifest, outDir, base, alias)
3. CONS-03: Django settings DJANGO_VITE.manifest_path points to scrapegrape/frontend/dist/manifest.json
4. CONS-04: Pages/, Components/, Layouts/ directories exist under scrapegrape/frontend/src/
5. Production build: `npm run build` succeeds and generates dist/manifest.json
6. Dev server: HMR works for component edits
7. Django admin: /admin/ accessible with correct styling
8. Static files: STATICFILES_DIRS includes frontend/dist/ for collectstatic
</verification>

<success_criteria>
- sgui/ directory does not exist
- scrapegrape/frontend/ contains all React source, config, and build output
- `cd scrapegrape/frontend && npm run build` succeeds
- `cd scrapegrape/frontend && npm run dev` starts HMR server
- Django dev server loads pages from new manifest_path
- Smoke test at /_debug/inertia/ renders correctly
- Legacy table view at / renders correctly
- Django admin at /admin/ has correct styling
- All 4 requirements (CONS-01 through CONS-04) satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/02-frontend-consolidation/02-01-SUMMARY.md`
</output>
