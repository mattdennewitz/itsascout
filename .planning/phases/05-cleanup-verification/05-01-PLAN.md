---
phase: 05-cleanup-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scrapegrape/templates/index.html
  - scrapegrape/templates/base.html
  - scrapegrape/frontend/src/App.tsx
  - scrapegrape/frontend/src/App.css
  - scrapegrape/frontend/src/main.tsx
  - scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx
  - scrapegrape/publishers/views.py
  - scrapegrape/scrapegrape/urls.py
autonomous: true

must_haves:
  truths:
    - "No templates use json_script filter or embed JSON for React to parse from DOM"
    - "No frontend code parses JSON from script elements (legacy App.tsx pattern removed)"
    - "No debug/smoke-test routes exist in URL configuration"
    - "react-router-dom is not in package.json or any import"
    - "sgui/ directory does not exist"
    - "Vite production build succeeds without errors after cleanup"
  artifacts:
    - path: "scrapegrape/templates/base.html"
      provides: "Clean Inertia base template without legacy blocks"
      contains: "block inertia"
    - path: "scrapegrape/scrapegrape/urls.py"
      provides: "URL routing without debug routes"
  key_links:
    - from: "scrapegrape/frontend/src/main.tsx"
      to: "scrapegrape/frontend/src/Pages/**/*.tsx"
      via: "import.meta.glob (Inertia page resolution)"
      pattern: "import\\.meta\\.glob.*Pages"
---

<objective>
Remove all legacy rendering artifacts, debug routes, and dead code from the Inertia refactor.

Purpose: Complete CLEN-01 (remove old JSON embedding), CLEN-02 (confirm react-router-dom absent), CLEN-03 (confirm sgui/ absent), and remove Phase 1 debug scaffolding. This makes the codebase reflect the final Inertia-only architecture with no vestigial patterns.

Output: Clean codebase with no legacy JSON-in-template rendering, no debug routes, no orphaned components.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove legacy template JSON embedding and dead frontend code</name>
  <files>
    scrapegrape/templates/index.html
    scrapegrape/templates/base.html
    scrapegrape/frontend/src/App.tsx
    scrapegrape/frontend/src/App.css
    scrapegrape/frontend/src/main.tsx
  </files>
  <action>
    **Delete `scrapegrape/templates/index.html`** entirely. This template uses `{{ serialized|json_script:"publisher-data" }}` to embed JSON for the old `App.tsx` to parse from the DOM. With Inertia, the publisher view uses `inertia_render()` which renders through `base.html` directly via `INERTIA_LAYOUT = 'base.html'`. The index.html template is no longer referenced by any view.

    **Clean `scrapegrape/templates/base.html`**: Remove the `{% block extra_body %}{% endblock %}` line (line 18). This block only existed for index.html's JSON embedding. Keep the `{% block inertia %}{% endblock %}` block — this is used by Inertia's template rendering. Keep `{% block extra_head %}{% endblock %}` as it's a standard extensibility point.

    **Delete `scrapegrape/frontend/src/App.tsx`**: This is the legacy root component that parsed JSON from `document.getElementById('publisher-data')`. It is NOT imported by any current code — `main.tsx` uses `createInertiaApp` and resolves pages from `Pages/**/*.tsx`, never referencing `App.tsx`.

    **Delete `scrapegrape/frontend/src/App.css`**: Contains body/th styles. Before deleting, verify that the styles in `App.css` (body background `#FAF8F6`, font-family `"Courier"`, th font-weight bold) are already present in `index.css` or the AppLayout. If not, move them to `index.css` before deleting. The `main.tsx` imports `App.css` — remove that import line from `main.tsx` (line 5: `import './App.css'`). If styles need to be preserved, add them to `index.css` first.

    **Also delete** `scrapegrape/frontend/src/main.tsx~` if it exists (backup file from editing).

    **Confirm CLEN-02**: Verify `react-router-dom` does not appear in `scrapegrape/frontend/package.json` — it was already confirmed absent during discovery. No action needed.

    **Confirm CLEN-03**: Verify `sgui/` directory does not exist at project root — it was already confirmed absent during discovery. No action needed.
  </action>
  <verify>
    Run: `grep -r "json_script" scrapegrape/templates/` returns no matches.
    Run: `ls scrapegrape/frontend/src/App.tsx 2>/dev/null` returns nothing (file deleted).
    Run: `grep "App.css" scrapegrape/frontend/src/main.tsx` returns no matches.
    Run: `grep "react-router-dom" scrapegrape/frontend/package.json` returns no matches.
    Run: `ls sgui/ 2>/dev/null` returns nothing.
  </verify>
  <done>
    CLEN-01: No templates contain json_script filter or JSON embedding for React DOM parsing.
    CLEN-02: react-router-dom not present in dependencies or imports.
    CLEN-03: sgui/ directory does not exist.
    Legacy App.tsx and App.css deleted. main.tsx no longer imports App.css.
  </done>
</task>

<task type="auto">
  <name>Task 2: Remove debug smoke test route and page component</name>
  <files>
    scrapegrape/publishers/views.py
    scrapegrape/scrapegrape/urls.py
    scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx
  </files>
  <action>
    **Remove `inertia_smoke_test` view from `scrapegrape/publishers/views.py`**: Delete the function at lines 85-93 (the `inertia_smoke_test` function and its docstring). This was explicitly marked "remove in Phase 5 cleanup" in the docstring. The `table`, `create`, `update`, and `bulk_upload` views remain unchanged.

    **Remove debug URL pattern from `scrapegrape/scrapegrape/urls.py`**: Delete line 25: `path("_debug/inertia/", publishers.views.inertia_smoke_test, name="debug-inertia"),`. All other URL patterns (`admin/`, `publishers/create`, `publishers/<id>/edit`, `publishers/bulk-upload`, and `""`) remain unchanged.

    **Delete `scrapegrape/frontend/src/Pages/Debug/InertiaTest.tsx`**: Remove the entire file. Then remove the empty `scrapegrape/frontend/src/Pages/Debug/` directory.

    **Verify `import.meta.glob` won't break**: The glob pattern `./Pages/**/*.tsx` dynamically resolves all pages. Removing `Debug/InertiaTest.tsx` simply removes it from the resolved set — no code references it by name except the deleted smoke test view. No other changes needed.
  </action>
  <verify>
    Run: `grep "smoke_test\|_debug\|InertiaTest" scrapegrape/publishers/views.py scrapegrape/scrapegrape/urls.py` returns no matches.
    Run: `ls scrapegrape/frontend/src/Pages/Debug/ 2>/dev/null` returns nothing (directory deleted).
    Run: `cd scrapegrape/frontend && npx tsc --noEmit` exits 0 (TypeScript still compiles).
    Run: `cd scrapegrape/frontend && npm run build` exits 0 (Vite build succeeds).
  </verify>
  <done>
    Debug smoke test route `/_debug/inertia/` removed from URL configuration.
    `inertia_smoke_test` view function removed from views.py.
    `Pages/Debug/InertiaTest.tsx` page component and Debug directory deleted.
    Vite build and TypeScript compilation succeed after removal.
  </done>
</task>

</tasks>

<verification>
1. `grep -r "json_script" scrapegrape/templates/` — no matches
2. `grep -r "react-router-dom" scrapegrape/frontend/` — no matches
3. `ls sgui/ 2>/dev/null` — no output (directory gone)
4. `ls scrapegrape/frontend/src/App.tsx 2>/dev/null` — no output (file gone)
5. `ls scrapegrape/frontend/src/Pages/Debug/ 2>/dev/null` — no output (directory gone)
6. `grep "_debug\|smoke_test" scrapegrape/scrapegrape/urls.py` — no matches
7. `cd scrapegrape/frontend && npm run build` — exits 0
8. `uv run python scrapegrape/manage.py check` — exits 0
</verification>

<success_criteria>
- CLEN-01: No templates contain json_script filter. No frontend code parses JSON from DOM script elements.
- CLEN-02: react-router-dom not in package.json or any frontend imports.
- CLEN-03: sgui/ directory does not exist.
- Debug route `/_debug/inertia/` removed. Debug page component deleted.
- Vite production build completes without errors.
- Django system check passes.
</success_criteria>

<output>
After completion, create `.planning/phases/05-cleanup-verification/05-01-SUMMARY.md`
</output>
