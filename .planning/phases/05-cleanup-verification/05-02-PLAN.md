---
phase: 05-cleanup-verification
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "Publisher table loads at / with all columns and correct data"
    - "Create publisher form submits and redirects with success flash message"
    - "Edit publisher form loads existing data and submits updates"
    - "Bulk CSV upload processes file and queues analysis tasks"
    - "Django admin is accessible at /admin/ with correct styling"
    - "Development server starts with HMR working"
  artifacts: []
  key_links:
    - from: "scrapegrape/publishers/views.py"
      to: "scrapegrape/frontend/src/Pages/Publishers/Index.tsx"
      via: "inertia_render with Publishers/Index"
      pattern: "inertia_render.*Publishers/Index"
    - from: "scrapegrape/publishers/views.py"
      to: "scrapegrape/frontend/src/Pages/Publishers/Create.tsx"
      via: "inertia_render with Publishers/Create"
      pattern: "inertia_render.*Publishers/Create"
---

<objective>
Verify all existing functionality works identically after the Inertia refactor and Phase 5 cleanup.

Purpose: Complete CLEN-04 — confirm every feature from the pre-refactor checklist works. This is the final gate before declaring the v1.0 Inertia Refactor milestone complete.

Output: Verified working application with all 20/20 requirements met.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-cleanup-verification/05-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Automated verification of build, server, and route integrity</name>
  <files></files>
  <action>
    Run a comprehensive automated verification checklist. All checks must pass:

    **Build verification:**
    1. `cd scrapegrape/frontend && npm run build` — Vite production build completes without errors
    2. Verify `scrapegrape/frontend/dist/manifest.json` exists and is valid JSON
    3. `uv run python scrapegrape/manage.py check` — Django system check passes with no errors

    **Dead code verification (post-cleanup):**
    4. `grep -r "json_script" scrapegrape/templates/` — no matches (CLEN-01)
    5. `grep -r "react-router-dom" scrapegrape/frontend/` — no matches (CLEN-02)
    6. `ls sgui/ 2>/dev/null` — directory does not exist (CLEN-03)
    7. `grep -r "JSON.parse.*publisher-data\|getElementById.*publisher-data" scrapegrape/frontend/src/` — no matches (legacy DOM parsing gone)
    8. `grep "_debug" scrapegrape/scrapegrape/urls.py` — no matches (debug routes gone)

    **Route verification:**
    9. Verify all URL patterns resolve: `uv run python scrapegrape/manage.py show_urls 2>/dev/null || uv run python -c "from scrapegrape.urls import urlpatterns; print([p.pattern for p in urlpatterns])"` — should show admin/, publishers/create, publishers/<id>/edit, publishers/bulk-upload, and "" (root)
    10. Verify no `/_debug/` route exists

    **Inertia integration verification:**
    11. Verify `INERTIA_LAYOUT = 'base.html'` in settings
    12. Verify `InertiaMiddleware` in MIDDLEWARE list
    13. Verify `scrapegrape.middleware.inertia_share` in MIDDLEWARE list
    14. Verify `base.html` contains `{% block inertia %}` (required by Inertia)

    If any check fails, diagnose and fix the issue before proceeding.
  </action>
  <verify>
    All 14 checks pass with expected output. Build artifacts exist. No legacy patterns remain.
  </verify>
  <done>
    Automated verification confirms: production build works, Django check passes, all legacy patterns removed, all routes correct, Inertia configuration intact.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Manual verification of all application features</name>
  <what-built>Complete Inertia refactor with all cleanup applied. The application should work identically to pre-refactor state but now uses Inertia.js for all page rendering instead of JSON-in-template embedding.</what-built>
  <how-to-verify>
    Start the development servers if not already running:
    - Backend: `cd scrapegrape && uv run python manage.py runserver`
    - Frontend: `cd scrapegrape/frontend && npm run dev`

    **1. Publisher Table (/):**
    - Load http://localhost:8000/ — publisher table renders with all columns
    - Table has sorting (click column headers)
    - Table rows expand to show details
    - Search field filters publishers (type a name, table updates after 300ms debounce)
    - Loading spinner appears briefly while deferred data loads

    **2. Create Publisher (/publishers/create):**
    - Navigate to create page via navigation link
    - Submit empty form — validation errors display
    - Submit valid form — redirects to table with success flash message

    **3. Edit Publisher (/publishers/{id}/edit):**
    - Click edit on a publisher — form loads with existing name and URL
    - Submit changes — redirects to table with success flash message

    **4. Bulk Upload (/publishers/bulk-upload):**
    - Navigate to bulk upload page
    - Upload a CSV file — success message shows count of queued URLs

    **5. Django Admin (/admin/):**
    - Load http://localhost:8000/admin/ — admin renders with correct CSS (not intercepted by Inertia)
    - Admin actions visible (WAF scan, terms discovery, terms evaluation)

    **6. Navigation:**
    - All page transitions are SPA-like (no full page flash/reload)
    - Flash messages appear and auto-dismiss after 5 seconds
    - Browser back/forward buttons work correctly

    **7. Verify no debug route:**
    - Visit http://localhost:8000/_debug/inertia/ — should return 404
  </how-to-verify>
  <resume-signal>Type "approved" if all features work correctly, or describe any issues found.</resume-signal>
</task>

</tasks>

<verification>
CLEN-04 acceptance criteria:
1. WAF scan functionality accessible via admin actions
2. ToS discovery/evaluation accessible via admin actions
3. Bulk CSV import works from /publishers/bulk-upload
4. Admin interface fully functional at /admin/
5. Publisher table renders with all data columns
6. SPA navigation works without full page reloads
7. Form validation displays errors correctly
8. Flash messages appear and auto-dismiss
</verification>

<success_criteria>
- CLEN-04: All existing functionality verified working identically after refactor
- All 20/20 milestone requirements confirmed complete
- No regressions in any previously working feature
- Human verification confirms visual and interactive correctness
</success_criteria>

<output>
After completion, create `.planning/phases/05-cleanup-verification/05-02-SUMMARY.md`
</output>
