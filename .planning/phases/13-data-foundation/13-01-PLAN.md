---
phase: 13-data-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - scrapegrape/publishers/models.py
  - scrapegrape/publishers/migrations/0008_competitive_intelligence_fields.py
  - scrapegrape/publishers/tests/test_models.py
autonomous: true

must_haves:
  truths:
    - "Publisher model has 8 new flat fields for CC presence, news sitemap, Google News readiness, and update frequency"
    - "ResolutionJob model has 4 new JSONFields for cc_result, sitemap_analysis_result, frequency_result, and news_signals_result"
    - "Migration 0008 applies cleanly to existing database without affecting existing data"
    - "Migration 0008 rolls back cleanly to 0007"
    - "All new fields are nullable or have safe defaults (no existing row breakage)"
  artifacts:
    - path: "scrapegrape/publishers/models.py"
      provides: "Publisher and ResolutionJob competitive intelligence fields"
      contains: "cc_in_index"
    - path: "scrapegrape/publishers/migrations/0008_competitive_intelligence_fields.py"
      provides: "Django migration adding 12 new fields"
      contains: "AddField"
    - path: "scrapegrape/publishers/tests/test_models.py"
      provides: "Default value tests for all new fields"
      contains: "cc_in_index"
  key_links:
    - from: "scrapegrape/publishers/migrations/0008_competitive_intelligence_fields.py"
      to: "scrapegrape/publishers/models.py"
      via: "Django migration system"
      pattern: "dependencies.*0007"
---

<objective>
Add all competitive intelligence model fields to Publisher and ResolutionJob, generate the migration, and verify with tests.

Purpose: Phases 14-18 need storage fields to exist before any pipeline steps produce data. This phase ensures the schema is ready.
Output: Updated models.py, migration 0008, updated test_models.py
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/13-data-foundation/13-RESEARCH.md
@scrapegrape/publishers/models.py
@scrapegrape/publishers/tests/test_models.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add competitive intelligence fields to Publisher and ResolutionJob models and generate migration</name>
  <files>scrapegrape/publishers/models.py, scrapegrape/publishers/migrations/0008_competitive_intelligence_fields.py</files>
  <action>
Add 8 new flat fields to the Publisher model, placed after `has_paywall` and before the `FETCH_STRATEGY_CHOICES` block. Group them with a comment header:

```python
# Competitive intelligence fields (Phase 13: Data Foundation)
# CC presence (populated by Phase 14)
cc_in_index = models.BooleanField(null=True)
cc_page_count = models.IntegerField(null=True, blank=True)
cc_last_crawl = models.CharField(max_length=20, blank=True, default="")

# News sitemap (populated by Phase 15)
has_news_sitemap = models.BooleanField(null=True)

# Google News readiness (populated by Phase 16)
google_news_readiness = models.CharField(max_length=20, blank=True, default="")

# Update frequency (populated by Phase 15)
update_frequency = models.CharField(max_length=50, blank=True, default="")
update_frequency_hours = models.FloatField(null=True, blank=True)
update_frequency_confidence = models.CharField(max_length=10, blank=True, default="")
```

Add 4 new JSONFields to ResolutionJob, placed after `article_result`:

```python
# Competitive intelligence step results (Phase 13: Data Foundation)
cc_result = models.JSONField(null=True, blank=True)
sitemap_analysis_result = models.JSONField(null=True, blank=True)
frequency_result = models.JSONField(null=True, blank=True)
news_signals_result = models.JSONField(null=True, blank=True)
```

Then generate the migration:
```bash
uv run scrapegrape/manage.py makemigrations publishers --name competitive_intelligence_fields
```

Verify migration applies and rolls back:
```bash
uv run scrapegrape/manage.py migrate publishers
uv run scrapegrape/manage.py migrate publishers 0007
uv run scrapegrape/manage.py migrate publishers
```
  </action>
  <verify>
1. `uv run scrapegrape/manage.py showmigrations publishers` shows 0008_competitive_intelligence_fields as applied
2. `uv run scrapegrape/manage.py migrate publishers 0007` succeeds (rollback works)
3. `uv run scrapegrape/manage.py migrate publishers` succeeds (re-apply works)
  </verify>
  <done>Publisher has 8 new flat fields (cc_in_index, cc_page_count, cc_last_crawl, has_news_sitemap, google_news_readiness, update_frequency, update_frequency_hours, update_frequency_confidence). ResolutionJob has 4 new JSONFields (cc_result, sitemap_analysis_result, frequency_result, news_signals_result). Migration 0008 applies and rolls back cleanly.</done>
</task>

<task type="auto">
  <name>Task 2: Add default value tests for all new fields</name>
  <files>scrapegrape/publishers/tests/test_models.py</files>
  <action>
Add two new test methods to the existing test classes in test_models.py.

In `TestPublisherModel`, add after `test_publisher_default_field_values`:

```python
def test_publisher_competitive_intelligence_defaults(self, publisher):
    """New Phase 13 competitive intelligence fields have safe defaults."""
    assert publisher.cc_in_index is None
    assert publisher.cc_page_count is None
    assert publisher.cc_last_crawl == ""
    assert publisher.has_news_sitemap is None
    assert publisher.google_news_readiness == ""
    assert publisher.update_frequency == ""
    assert publisher.update_frequency_hours is None
    assert publisher.update_frequency_confidence == ""
```

In `TestResolutionJobModel`, add after `test_job_default_results_null`:

```python
def test_job_competitive_intelligence_results_null(self, resolution_job):
    """New Phase 13 competitive intelligence result fields default to null."""
    assert resolution_job.cc_result is None
    assert resolution_job.sitemap_analysis_result is None
    assert resolution_job.frequency_result is None
    assert resolution_job.news_signals_result is None
```
  </action>
  <verify>
```bash
uv run pytest scrapegrape/publishers/tests/test_models.py -v
```
All tests pass, including the two new test methods.
  </verify>
  <done>test_publisher_competitive_intelligence_defaults and test_job_competitive_intelligence_results_null both pass, confirming all 12 new fields have correct defaults.</done>
</task>

</tasks>

<verification>
1. `uv run scrapegrape/manage.py showmigrations publishers` -- 0008 applied
2. `uv run pytest scrapegrape/publishers/tests/test_models.py -v` -- all tests pass
3. `uv run scrapegrape/manage.py migrate publishers 0007 && uv run scrapegrape/manage.py migrate publishers` -- rollback + re-apply succeeds
</verification>

<success_criteria>
- Publisher model has exactly 8 new flat fields with correct types and defaults
- ResolutionJob model has exactly 4 new JSONFields (null=True, blank=True)
- Migration 0008_competitive_intelligence_fields.py exists and applies cleanly
- All existing tests still pass (no regressions)
- Two new test methods verify all 12 new field defaults
</success_criteria>

<output>
After completion, create `.planning/phases/13-data-foundation/13-01-SUMMARY.md`
</output>
