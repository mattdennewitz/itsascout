---
phase: 17-pipeline-integration
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - scrapegrape/frontend/src/Pages/Jobs/Show.tsx
autonomous: true

must_haves:
  truths:
    - "Step cards appear for sitemap_analysis, frequency, and google_news during live pipeline runs"
    - "Step data summaries display meaningful text for all three new steps"
    - "Completed jobs rebuild correct statuses for new steps from props on page load"
    - "Publisher-level and article-level step card groups are visually separated at the correct index"
  artifacts:
    - path: "scrapegrape/frontend/src/Pages/Jobs/Show.tsx"
      provides: "PIPELINE_STEPS with 16 entries, stepDataSummary branches for new steps, JobProps with new fields"
      contains: "sitemap_analysis"
  key_links:
    - from: "scrapegrape/frontend/src/Pages/Jobs/Show.tsx"
      to: "SSE events from supervisor.py"
      via: "PIPELINE_STEPS key matching event step names"
      pattern: "key: 'sitemap_analysis'.*key: 'frequency'.*key: 'google_news'"
---

<objective>
Add the three new pipeline steps to the frontend step card UI so they appear during live runs and on completed job page loads.

Purpose: Without these changes, the new steps execute in the backend but the user never sees their progress or results in the step card UI.
Output: Updated Show.tsx with complete step coverage for all 16 pipeline steps.
</objective>

<execution_context>
@/Users/matt/.claude/get-shit-done/workflows/execute-plan.md
@/Users/matt/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/17-pipeline-integration/17-RESEARCH.md
@scrapegrape/frontend/src/Pages/Jobs/Show.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add new steps to PIPELINE_STEPS, stepDataSummary, and JobProps</name>
  <files>scrapegrape/frontend/src/Pages/Jobs/Show.tsx</files>
  <action>
Make five changes to Show.tsx:

**1. Add new fields to JobProps interface** (after `cc_result` at line ~71):
```typescript
sitemap_analysis_result: Record<string, unknown> | null
frequency_result: Record<string, unknown> | null
news_signals_result: Record<string, unknown> | null
```

**2. Update PIPELINE_STEPS array** (lines 79-93). Insert `sitemap_analysis` and `frequency` after `cc` (publisher-level steps), and `google_news` at the end (after `metadata_profile`). Renumber icons for all subsequent steps. The full array should be:
```typescript
const PIPELINE_STEPS = [
    { key: 'publisher_details', label: 'Publisher Details', icon: '1' },
    { key: 'waf', label: 'WAF Detection', icon: '2' },
    { key: 'tos_discovery', label: 'ToS Discovery', icon: '3' },
    { key: 'tos_evaluation', label: 'ToS Evaluation', icon: '4' },
    { key: 'robots', label: 'robots.txt Analysis', icon: '5' },
    { key: 'ai_bot_blocking', label: 'AI Bot Blocking', icon: '6' },
    { key: 'sitemap', label: 'Sitemap Discovery', icon: '7' },
    { key: 'rss', label: 'RSS Feed Discovery', icon: '8' },
    { key: 'rsl', label: 'RSL Detection', icon: '9' },
    { key: 'cc', label: 'Common Crawl Presence', icon: '10' },
    { key: 'sitemap_analysis', label: 'Sitemap Analysis', icon: '11' },
    { key: 'frequency', label: 'Update Frequency', icon: '12' },
    { key: 'article_extraction', label: 'Article Metadata', icon: '13' },
    { key: 'paywall_detection', label: 'Paywall Detection', icon: '14' },
    { key: 'metadata_profile', label: 'Metadata Profile', icon: '15' },
    { key: 'google_news', label: 'Google News Readiness', icon: '16' },
] as const
```

**3. Add stepDataSummary branches** (before the final fallback lines at ~226-228, after the `metadata_profile` branch). Add three new branches:

```typescript
if (step === 'sitemap_analysis') {
    if (data.has_news_sitemap === true) return 'News sitemap detected'
    if (data.has_news_sitemap === false) return 'No news sitemap found'
    return null
}
if (step === 'frequency') {
    const label = data.frequency_label as string | undefined
    const confidence = data.confidence as string | undefined
    if (label) return `${label}${confidence ? ` (${confidence} confidence)` : ''}`
    if (data.error) return `Error: ${String(data.error)}`
    return 'Could not estimate frequency'
}
if (step === 'google_news') {
    const readiness = data.readiness as string | undefined
    const count = data.signal_count as number | undefined
    if (readiness) return `Readiness: ${readiness} (${count ?? 0}/3 signals)`
    if (data.error) return `Error: ${String(data.error)}`
    return null
}
```

**4. Add initialStatuses entries for new result fields** (in the `initialStatuses` useMemo, after the `cc_result` block at line ~824 and before `ai_bot_result`):

```typescript
if (job.sitemap_analysis_result) {
    statuses['sitemap_analysis'] = { step: 'sitemap_analysis', status: 'completed', data: job.sitemap_analysis_result }
}
if (job.frequency_result) {
    statuses['frequency'] = { step: 'frequency', status: 'completed', data: job.frequency_result }
}
if (job.news_signals_result) {
    statuses['google_news'] = { step: 'google_news', status: 'completed', data: job.news_signals_result }
}
```

**5. Update step card divider index** (lines ~978 and ~990). Change:
- `PIPELINE_STEPS.slice(0, 10)` to `PIPELINE_STEPS.slice(0, 12)` -- publisher-level steps now include sitemap_analysis and frequency (12 total)
- `PIPELINE_STEPS.slice(10)` to `PIPELINE_STEPS.slice(12)` -- article-level steps start at index 12

This ensures the "Article Analysis" heading appears between frequency (publisher-level) and article_extraction (article-level), with google_news appearing after metadata_profile in the article section.
  </action>
  <verify>
Run `cd /Users/matt/src/itsascout/scrapegrape/frontend && npx tsc --noEmit` to verify TypeScript compiles without errors.
Grep for `sitemap_analysis` in Show.tsx -- should appear in PIPELINE_STEPS, stepDataSummary, and initialStatuses.
Grep for `slice(0, 12)` in Show.tsx -- should appear once (publisher-level steps).
Grep for `slice(12)` in Show.tsx -- should appear once (article-level steps).
Count PIPELINE_STEPS entries -- should be exactly 16.
  </verify>
  <done>
Show.tsx has 16 pipeline step entries with correct icon numbering. Step data summaries display meaningful text for sitemap_analysis, frequency, and google_news. Completed jobs rebuild statuses from the three new result props. The publisher/article divider is at index 12.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `cd scrapegrape/frontend && npx tsc --noEmit` passes
2. PIPELINE_STEPS has exactly 16 entries
3. stepDataSummary has branches for sitemap_analysis, frequency, and google_news
4. initialStatuses handles sitemap_analysis_result, frequency_result, and news_signals_result
5. Step card divider splits at index 12 (12 publisher steps, 4 article/aggregation steps)
6. JobProps interface includes the three new result fields
</verification>

<success_criteria>
All 16 pipeline steps render as step cards during live runs. Completed jobs show data summaries for the three new steps. The publisher/article section divider appears at the correct position.
</success_criteria>

<output>
After completion, create `.planning/phases/17-pipeline-integration/17-02-SUMMARY.md`
</output>
